<!doctype html>
<html>
<head>
    <title>lakeFS Releases</title>
</head>
<body>
    <h1>lakeFS Releases</h1>

    <div id="releases"></div>

    <script>
        function buildReleaseHTML(version) {
            const app = 'lakeFS';
            const v = version.startsWith('v') ? version.substr(1) : version;
            const d = document.createElement('div');

            const headerText = document.createTextNode(version);
            const header = document.createElement('h3');
            header.appendChild(headerText);

            const ul = document.createElement('ul');

            for (let platform of ['Darwin', 'Linux', 'Windows']) {
                const name = `${app}_${v}_${platform}_x86_64.tar.gz`;
                const rel = document.createElement('A');
                rel.href = `/${app}/${version}/${name}`;
                rel.appendChild(document.createTextNode(name));
                const li = document.createElement('li');
                li.appendChild(rel);
                ul.appendChild(li);
            }

            d.appendChild(header);
            d.appendChild(ul);
            return d;
        }
        
    (async () => {
        try {
            const response = await fetch("https://releases-lakefs.s3.amazonaws.com/?delimiter=/&prefix=lakeFS/&list-type=2", {
                headers: { "Content-Type": "text/xml" }
            });
            const body = await response.text();
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(body, "text/xml");
            const releases = document.getElementById("releases");
            let versions = [];
            for (let el of xmlDoc.getElementsByTagName("Prefix")) {
                const v = el.firstChild.nodeValue.split('/')[1];
                if (v) {
                    versions.push(v);
                }
            }
            versions = versions.sort((a, b) => b.localeCompare(a, undefined, { numeric: true }));
            for (let version of versions) {
                releases.appendChild(buildReleaseHTML(version));
            }
        } catch(ex) {
            console.log("Unable to load releases", ex);
        }
    })();

    </script>

</body>
</html>
