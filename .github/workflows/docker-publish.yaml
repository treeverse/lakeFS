name: Docker
on:
  release:
    types: [published]

# These permissions are needed to interact with GitHub's OIDC Token endpoint.
permissions:
  id-token: write
  contents: read

jobs:
  deploy:
    name: Build and push Docker image
    runs-on: ubuntu-20.04
    steps:

      - name: Checkout
        uses: actions/checkout@v3

      - name: Trigger playground deploy
        run: |
          curl \
          -X POST \
          -H "Authorization: Bearer ${{ secrets.GH_TOKEN_DISPATCH_EVENT }}"\
          -H "Accept: application/vnd.github+json" \
          -H "Content-Type: application/json" \
          https://api.github.com/repos/${{ secrets.REPOSITORY_NAME }}/actions/workflows/${{ secrets.WORKFLOW_ID }}/dispatches \
          --data '{"ref":"main", "inputs": { "lakefs_image": "0.94.0" }}'
